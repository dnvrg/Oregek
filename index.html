<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idősgondozási Menedzser</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="mobile-header">
        <div class="mobile-header-content">
            <h1 class="mobile-title">Idősgondozás</h1>
            <button id="mobileMenuBtn" class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <div id="mobileMenuOverlay" class="mobile-menu-overlay">
        <div class="mobile-menu-content">
            <div class="mobile-menu-header">
                <h2>Menü</h2>
                <button id="closeMobileMenu">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="mobile-nav">
                <div id="mobileNavItems" class="nav-items">
                </div>
            </nav>
        </div>
    </div>

    <div class="app-layout">
        <aside class="desktop-sidebar">
            <div class="sidebar-header">
                <i class="fas fa-users sidebar-title-icon"></i>
            </div>
            
            <nav class="sidebar-nav">
                <div id="desktopNavItems" class="nav-items">
                </div>
                
                <div class="settings-section">
                    <h3>BEÁLLÍTÁSOK</h3>
                    <div class="settings-items">
                        <button onclick="downloadAllData()" class="settings-item">
                            <i class="fas fa-download"></i>
                            <span>Adatok letöltése</span>
                        </button>
                        <input type="file" id="uploadFile" accept=".json" style="display: none;">
                        <button onclick="document.getElementById('uploadFile').click()" class="settings-item">
                            <i class="fas fa-upload"></i>
                            <span>Adatok feltöltése</span>
                        </button>
                        <button onclick="deleteAllInfo()" class="settings-item btn-delete-all">
                            <i class="fas fa-trash-alt"></i>
                            <span>Összes adat törlése</span>
                        </button>
                    </div>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <div id="patients" class="tab-content active">
                <header class="content-header">
                    <div class="header-info">
                        <h2>Páciensek</h2>
                        <p>Gondozottak kezelése és nyomon követése</p>
                    </div>
                    <div class="header-actions">
                        <div class="search-container">
                            <input type="text" id="patientSearchInput" placeholder="Keresés páciensek között...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <button id="addPatientBtn" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            <span>Új páciens</span>
                        </button>
                    </div>
                </header>
                
                <div class="content-body">
                    <div id="patientsList" class="patients-grid">
                    </div>
                </div>
            </div>

            <div id="calendar" class="tab-content">
                <header class="content-header">
                    <div class="header-info">
                        <h2>Naptár</h2>
                        <p>Látogatások ütemezése és követése</p>
                    </div>
                    <div class="header-actions">
                        <select id="calendarMonth" class="form-select">
                            <option value="0">Január</option>
                            <option value="1">Február</option>
                            <option value="2">Március</option>
                            <option value="3">Április</option>
                            <option value="4">Május</option>
                            <option value="5">Június</option>
                            <option value="6">Július</option>
                            <option value="7">Augusztus</option>
                            <option value="8">Szeptember</option>
                            <option value="9">Október</option>
                            <option value="10">November</option>
                            <option value="11">December</option>
                        </select>
                        <input type="number" id="calendarYear" min="2020" max="2030" class="form-input year-input">
                    </div>
                </header>
                
                <div class="content-body">
                    <div id="calendarGrid" class="calendar-grid">
                    </div>
                </div>
            </div>

            <div id="shopping" class="tab-content">
                <header class="content-header">
                    <div class="header-info">
                        <h2>Bevásárló Lista</h2>
                        <p>Szükséges tételek követése</p>
                    </div>
                    <div class="header-actions">
                        <div class="search-container">
                            <input type="text" id="shoppingSearchInput" placeholder="Keresés listában...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                    </div>
                </header>
                
                <div class="form-section shopping-form-section">
                    <div class="shopping-input-group">
                        <form id="shoppingForm" class="inline-form">
                            <input type="text" id="shoppingItem" placeholder="Új tétel hozzáadása..." required class="form-input">
                            <select id="shoppingPatient" class="form-select">
                                <option value="">Válasszon pácienst</option>
                            </select>
                            <button type="submit" class="btn btn-primary">Hozzáad</button>
                        </form>
                    </div>
                    <div class="separator-line"></div>
                    <button id="openGeminiModalBtn" class="btn btn-lg btn-primary ai-button">
                        <i class="fas fa-magic"></i>
                        <span>AI elemzés</span>
                    </button>
                </div>
                
                <div class="content-body">
                    <div id="shoppingList" class="shopping-list-container">
                    </div>
                </div>
            </div>

            <div id="documents" class="tab-content">
                <header class="content-header">
                    <div class="header-info">
                        <h2>Dokumentumok</h2>
                        <p>Páciens dokumentumok kezelése</p>
                    </div>
                    <div class="header-actions">
                        <div class="search-container">
                            <input type="text" id="documentsSearchInput" placeholder="Keresés dokumentumokban...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                    </div>
                </header>
                
                <div class="content-body">
                    <div class="bg-white p-6 rounded-3xl shadow-xl w-full mx-auto mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Feltöltés</h2>
                        <div id="drop-area" class="flex flex-col items-center justify-center p-8 text-center border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-purple-400 transition-colors duration-200">
                            <button id="file-btn" class="px-6 py-3 bg-[#8B5CF6] text-white rounded-xl font-medium hover:bg-[#7e47e5] transition-colors duration-200">
                                Fájl(ok) kiválasztása
                            </button>
                            <p class="text-gray-500 mt-4">vagy húzza ide a fájlokat</p>
                            <p class="text-gray-500 text-sm mt-2">Több fájlt is kiválaszthat egyszerre.</p>
                            <input type="file" id="documentFile" multiple class="hidden">
                        </div>
                        <div class="mt-4">
                            <label for="documentPatient" class="block text-gray-700 font-medium">Feltöltés a következőnek:</label>
                            <select id="documentPatient" class="w-full mt-1 p-2 border border-gray-300 rounded-md">
                                <option value="">Válasszon pácienst</option>
                            </select>
                        </div>
                        <div id="upload-message" class="mt-4 text-sm font-medium text-center hidden"></div>
                    </div>
                    
                    <div class="p-8 rounded-[2rem] shadow-xl w-full mx-auto bg-lilac-50 border-2 border-lilac-200">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6">Feltöltött dokumentumok</h2>
                        <div class="documents-grid">
                            </div>
                    </div>
                </div>
                </div>

            <div id="notes" class="tab-content">
                <header class="content-header">
                    <div class="header-info">
                        <h2>Jegyzetek</h2>
                        <p>Fontos megjegyzések és észrevételek</p>
                    </div>
                    <div class="header-actions">
                        <div class="search-container">
                            <input type="text" id="notesSearchInput" placeholder="Keresés jegyzetekben...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                    </div>
                </header>
                <div class="notes-app-container">
                    <div class="patient-dropdown-container">
                        <div class="patient-dropdown-header" id="patient-dropdown-toggle">
                            <span id="selected-patient-name">Betegek</span>
                            <i class="fas fa-chevron-down transform transition-transform duration-300" id="dropdown-arrow"></i>
                        </div>
                        <div id="patient-dropdown-list" class="dropdown-list">
                            </div>
                    </div>
                    
                    <div class="notes-grid-container">
                        <div class="notes-grid-header">
                            <h2 id="patient-name-header" class="text-2xl font-semibold text-gray-800"></h2>
                        </div>
                        <i class="fas fa-plus text-xl text-gray-500 cursor-pointer hover:text-gray-800" id="add-note-btn"></i>
                        <div id="pinned-notes-section" class="pinned-notes-section">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4 hidden" id="pinned-notes-header">Rögzített jegyzetek</h3>
                            <div id="pinned-notes-row" class="pinned-notes-row">
                                </div>
                        </div>
                        <div id="notes-divider" class="border-b-2 border-gray-300 mt-4 mb-8 hidden"></div>
                        <div class="notes-grid" id="notes-grid">
                            </div>
                    </div>
                </div>
            </div>

            <div id="calculator" class="tab-content">
                <header class="content-header">
                    <div class="header-info">
                        <h2>Kiszámoló</h2>
                        <p>Időbeosztás és számítások</p>
                    </div>
                    <div class="header-actions calculator-actions">
                        <button id="export-btn" class="btn btn-success">
                            <i class="fas fa-download"></i>
                            <span>Export</span>
                        </button>
                        <button id="save-btn" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            <span>Mentés</span>
                        </button>
                        <button id="add-row-btn" class="btn btn-purple">
                            <i class="fas fa-plus"></i>
                            <span>Sor</span>
                        </button>
                        <button id="clear-table-btn" class="btn btn-danger">
                            <i class="fas fa-trash"></i>
                            <span>Törlés</span>
                        </button>
                    </div>
                </header>
                
                <div class="content-body">
                    <div class="table-container">
                        <table id="calculation-table" class="calculation-table">
                            <thead>
                                <tr>
                                    <th>Név</th>
                                    <th>G1</th>
                                    <th>G2</th>
                                    <th>G+U</th>
                                    <th>Óra</th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="saved-calculations">
                        <h3>Mentett számítások</h3>
                        <div id="saved-calculations-list" class="saved-list">
                        </div>
                    </div>
                </div>
            </div>

            <div id="patientModal" class="modal-overlay">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modalTitle">Új páciens</h3>
                        <button id="closeModal" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <form id="patientForm" class="modal-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="name">Név *</label>
                                <input type="text" id="name" required class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="phone">Telefonszám *</label>
                                <input type="tel" id="phone" required class="form-input">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="address">Lakcím</label>
                            <input type="text" id="address" class="form-input">
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="intercom">Kapukód</label>
                                <input type="text" id="intercom" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="birthplace">Születési hely</label>
                                <input type="text" id="birthplace" class="form-input">
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="birthdate">Születési idő</label>
                                <input type="date" id="birthdate" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="mothersName">Anyja neve</label>
                                <input type="text" id="mothersName" class="form-input">
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="taj">TAJ Szám</label>
                                <input type="text" id="taj" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="emergencyContact">Értesítendő</label>
                                <input type="text" id="emergencyContact" class="form-input">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="emergencyPhone">Értesítendő Telefonszáma</label>
                            <input type="tel" id="emergencyPhone" class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="tasks">Feladatok</label>
                            <textarea id="tasks" rows="3" placeholder="Sorolja fel a páciens gondozási feladatait..." class="form-textarea"></textarea>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="patientColor">Naptár Szín</label>
                                <div class="color-picker-container">
                                    <input type="color" id="patientColor" value="#8b5cf6" class="color-picker">
                                    <span>Válasszon színt a naptárhoz</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Látogatási Napok</label>
                                <div class="checkbox-grid">
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="monday" value="1">
                                        <span>Hétfő</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="tuesday" value="2">
                                        <span>Kedd</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="wednesday" value="3">
                                        <span>Szerda</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="thursday" value="4">
                                        <span>Csütörtök</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="friday" value="5">
                                        <span>Péntek</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button type="button" id="cancelBtn" class="btn btn-secondary">Mégse</button>
                            <button type="submit" class="btn btn-primary">Mentés</button>
                            <button type="button" id="deletePatientBtn" class="btn btn-danger hidden">Törlés</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="save-modal" class="modal-overlay">
                <div class="modal-content modal-sm">
                    <div class="modal-body">
                        <h3 id="modal-title">Számítás mentése</h3>
                        <p>Adja meg a mentés nevét:</p>
                        <input type="text" id="save-name-input" placeholder="Pl. Heti számítás" class="form-input">
                        <div class="modal-actions">
                            <button id="save-cancel-btn" class="btn btn-secondary">Mégsem</button>
                            <button id="save-confirm-btn" class="btn btn-primary">Mentés</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="dayDetailModal" class="modal-overlay">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="dayDetailTitle"></h3>
                        <button id="closeDayDetailModal" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="dayDetailsContent" class="card-grid">
                        </div>
                    </div>
                </div>
            </div>

            <div id="calculationDetailModal" class="modal-overlay">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="calculationDetailTitle">Mentett számítás</h3>
                        <button id="closeCalculationDetailModal" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>A táblázat szerkesztése után kattintson a "Mentés" gombra a változások elmentéséhez.</p>
                        <div class="table-container">
                            <table id="detail-calculation-table" class="calculation-table">
                                <thead>
                                    <tr>
                                        <th>Név</th>
                                        <th>G1</th>
                                        <th>G2</th>
                                        <th>G+U</th>
                                        <th>Óra</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="detail-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button id="add-row-detail-btn" class="btn btn-purple">
                            <i class="fas fa-plus"></i>
                            <span>Sor hozzáadása</span>
                        </button>
                        <button id="delete-calc-btn" class="btn btn-danger">
                            <i class="fas fa-trash"></i>
                            <span>Számítás törlése</span>
                        </button>
                        <button id="load-calc-btn" class="btn btn-secondary">
                            <i class="fas fa-sync"></i>
                            <span>Betöltés a fő táblába</span>
                        </button>
                        <button id="save-calc-btn" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            <span>Mentés</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="popup-overlay" id="popupOverlay">
                <div class="popup">
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex-grow max-w-[75%]">
                            <h1 id="file-name" class="text-2xl font-semibold text-gray-800 cursor-pointer hover:text-gray-600 transition-colors duration-200 truncate"></h1>
                            <input type="text" id="edit-input" class="text-2xl font-semibold text-gray-800 hidden p-1 border border-gray-300 rounded-md w-full" value="">
                        </div>
                        <div class="bg-red-100 text-red-500 w-14 h-14 p-4 flex items-center justify-center rounded-lg hover:bg-red-200 transition-colors duration-200 shrink-0">
                            <i id="delete-doc-btn" class="fas fa-trash-alt text-lg"></i>
                        </div>
                    </div>
                    <div class="text-gray-600 space-y-2 mb-6">
                        <p><strong>Páciens:</strong> <span id="popup-patient"></span></p>
                        <p><strong>Dátum:</strong> <span id="popup-date"></span></p>
                        <p><strong>Méret:</strong> <span id="popup-size"></span></p>
                    </div>
                    <div class="space-y-4">
                        <button id="view-doc-btn" class="w-full flex items-center justify-center gap-2 p-4 rounded-xl text-white bg-[#8B5CF6] hover:bg-[#7e47e5] transition-colors duration-200">
                            <i class="fas fa-eye text-lg"></i>
                            <span class="font-medium">Megtekintés</span>
                        </button>
                        <button id="download-doc-btn" class="w-full flex items-center justify-center gap-2 p-4 rounded-xl text-[#8B5CF6] bg-gray-100 hover:bg-gray-200 transition-colors duration-200">
                            <i class="fas fa-download text-lg"></i>
                            <span class="font-medium">Letöltés</span>
                        </button>
                    </div>
                </div>
            </div>

            <div id="cameraModal" class="camera-modal">
                <div class="camera-modal-content">
                    <video id="cameraFeed" class="camera-stream" autoplay playsinline></video>
                    <div class="camera-actions">
                        <button id="takePhotoBtn" class="btn btn-primary"><i class="fas fa-camera"></i> Kép készítése</button>
                        <button id="cancelPhotoBtn" class="btn btn-secondary"><i class="fas fa-times"></i> Mégse</button>
                    </div>
                    <p id="cameraMessage" class="camera-message hidden">A kamera funkció nem támogatott ezen az eszközön vagy böngészőben.</p>
                </div>
            </div>

            <div id="geminiMainModal" class="modal-overlay">
                <div class="modal-content modal-md">
                    <div class="modal-header">
                        <h3>Gemini AI - Lista elemzés képről</h3>
                        <button id="closeGeminiMainModal" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Készítsen fotót egy kézzel írott bevásárlólistáról, és hagyja, hogy az AI automatikusan hozzáadja a tételeket a listához.</p>
                        <div class="inline-form mb-4">
                            <div class="form-group-note">
                                <label for="geminiPatientSelect">Páciens</label>
                                <select id="geminiPatientSelect" class="form-select gemini-patient-select" required>
                                    <option value="">Válasszon pácienst</option>
                                </select>
                            </div>
                            <button id="openCameraBtn" class="btn btn-secondary"><i class="fas fa-camera"></i> Kamera megnyitása</button>
                            <input type="file" id="uploadImageFile" accept="image/*" style="display: none;">
                            <button id="uploadImageBtn" class="btn btn-secondary"><i class="fas fa-upload"></i> Kép feltöltése</button>
                        </div>
                        <div class="flex flex-col items-center mt-4">
                            <img id="imagePreview" class="camera-preview hidden" alt="Kép előnézete">
                            <button id="analyzeBtn" class="btn btn-primary mt-4 hidden"><i class="fas fa-magic"></i> Lista elemzés</button>
                            <div id="loadingIndicator" class="loading-indicator hidden">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>Elemzés folyamatban...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="geminiConfirmModal" class="modal-overlay">
                <div class="modal-content modal-sm">
                    <div class="modal-header">
                        <h3>Bevásárlólista Elemzés</h3>
                        <button id="closeGeminiConfirmModal" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Az AI a következő tételeket azonosította a listán a(z) <span id="geminiPatientName" class="font-semibold"></span> páciens számára. Kérjük, erősítse meg vagy szerkessze a listát.</p>
                        <div id="geminiItemsList" class="gemini-list-container">
                            </div>
                    </div>
                    <div class="modal-actions">
                        <button id="geminiCancelBtn" class="btn btn-secondary">Mégsem</button>
                        <button id="geminiConfirmBtn" class="btn btn-primary">Hozzáadás</button>
                    </div>
                </div>
            </div>
            
            <div id="infoModal" class="modal-overlay">
                <div class="modal-content modal-xs">
                    <div class="modal-body text-center">
                        <p id="infoMessage" class="modal-message"></p>
                    </div>
                </div>
            </div>
            
            <div id="successModal" class="modal-overlay">
                <div class="modal-content modal-xs success-modal-content">
                    <div class="modal-body text-center">
                        <p id="successMessage" class="modal-message"></p>
                    </div>
                </div>
            </div>
            
            <div id="errorModal" class="modal-overlay">
                <div class="modal-content modal-xs error-modal-content">
                    <div class="modal-body text-center">
                        <p id="errorMessage" class="modal-message"></p>
                    </div>
                </div>
            </div>
            
            <div id="confirmModal" class="modal-overlay">
                <div class="modal-content modal-xs">
                    <div class="modal-body text-center">
                        <p id="confirmMessage" class="modal-message"></p>
                        <div class="modal-actions justify-center">
                            <button class="btn btn-secondary cancel-btn">Mégsem</button>
                            <button class="btn btn-primary confirm-btn">Igen</button>
                        </div>
                    </div>
                </div>
            </div>

    <script src="script.js"></script>
</body>
</html>
